{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}




{% block content %}
 
    


    <div class="actions">
        <a href="{% url 'request_ticket' %}">
            <button class="style-button">Demander une critique</button>
        </a>    
        
            <a href="{% url 'review_without_ticket' %}">
                <button class="style-button">Créer une critique</button>
            </a>        
    </div>

    <div class="posts-container">
        {% for post in posts %}
            {% if post.type == 'ticket' %}
                <div class="ticket">
                    <h3 class="title-post">
                        {% if request.user.username == post.user.username %}
                            Vous avez demandé une critique
                        {% else %}
                            {{ post.user.username }} a demandé une critique
                        {% endif %}
                    </h3>
                    <p>{{ post.description }}</p>
                    {% if post.image %}
                        <div class="image-container">
                            <img src="{{post.image.url}}" alt="Image pour le ticket {{ post.title }}" class="ticket-image">
                        </div>
                    {% endif %}
                    <small>Posté par {{ post.user.username }} le  {{ post.created_at|date:"H:i, d M Y"}}</small>
                    {% if not post.user.is_authenticated and not post.review_set.exists %}                       
                        <a href="{% url 'review_with_ticket' ticket_id=post.id  %}">
                            <button class="style-button">Créer une critique</button>
                        </a>                        
                    {% endif %}
                    
                </div>
            {% elif post.type == 'review' %}
                <div class="review">
                    
                        <h3 class="title-post">
                            {% if request.user.username == post.user.username %}
                                Vous avez publié une critique
                            {% else %}
                                {{ post.user.username }} a publié une critique
                            {% endif %}
                        </h3>                                          
                    {% endif %}
                    <p><strong>Critique de {{ post.user.username }}</strong></p>
                    <p>{{ post.content }}</p>
                    <p>{{ post.rating }} / 5 - 
                        {% for _ in post.full_stars %}
                            <span style="color: black; font-size: 1.2rem;">&#9733;</span>
                        {% endfor %}
                        {% for _ in post.empty_stars %}
                            <span style="color: lightgray; font-size: 1.2rem;">&#9734;</span>
                        {% endfor %}
                    </p>
                    <small>Posté le {{ post.created_at|date:"H:i, d M Y" }}</small>

                    {% if post.ticket %}
                    <div class="ticket">
                        <p>Ticket - {{ post.ticket.user.username }}</p>
                        <h4>{{ post.ticket.title }}</h4>
                        <p>{{ post.ticket.description }}</p>
                        {% if post.ticket.image %}
                            <div class="image-container">
                                <img src="{{ post.ticket.image.url }}" alt="Image pour le ticket {{ post.ticket.title }}" class="ticket-image">
                            </div>
                        {% endif %}                    
                    </div>
                     
                </div>
            {% endif %}
        {% endfor %}

    
   

{% endblock %}